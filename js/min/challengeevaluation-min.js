$(document).ready(function(){Parse.initialize("l3iYSEoRauE5ctDyD6CwojGCGIyJHxeCmgEMhnjZ","prAydsNAqfn6j4BYudc9iJhvavc0C5IcMUyOC6Yj");var e=Parse.User.current();e.fetch({success:function(e){for(var i=e.get("challengeScore").answerKey,t=e.get("challengeScore").userSelection,l=0,n=i.length,r=0,a=1,c=!0,g=0;g<i.length;g++)i[g]===t[g]&&l++;r=l/n;var s=e.get("currentChallengeType"),o=0,f=parseInt(e.get("progress")),u=parseInt(e.get("level")),h=e.get("levelResistance"),k=0,S=(new Date).getTime();e.set("timeSinceLastChallenge",S),"Critical Thinking"===s?(o=e.get("criticalthinkingSkill"),challengeDifficulty=e.get("currentChallengeDifficulty"),"easy"===challengeDifficulty?(o+=1*r,f+=5*r*h,o>100&&(o=100),f>100&&(f=0,u+=1,h>.06&&(h-=.02))):"medium"===challengeDifficulty?(o+=2.5*r,f+=10*r*h,o>100&&(o=100),f>100&&(f=0,u+=1,h>.06&&(h-=.02))):"hard"===challengeDifficulty&&(o+=5*r,f+=50*r*h,o>100&&(o=100),f>100&&(f=0,u+=1,h>.06&&(h-=.02))),e.set("levelResistance",h),e.set("progress",f.toString()),e.set("level",u.toString()),e.set("criticalthinkingSkill",o),k=(u+9)*((e.get("criticalthinkingSkill")+e.get("timetrialSkill")+e.get("recognitionSkill")+e.get("definitionsSkill")+e.get("aboveandbeyondSkill"))/500),e.set("trueRank",k),e.save()):"Time Trials"===s?(o=e.get("timetrialSkill"),challengeDifficulty=e.get("currentChallengeDifficulty"),"easy"===challengeDifficulty?(o+=1*r,f+=5*r*h,o>100&&(o=100),f>100&&(f=0,u+=1,h>.06&&(h-=.02))):"medium"===challengeDifficulty?(o+=2.5*r,f+=10*r*h,o>100&&(o=100),f>100&&(f=0,u+=1,h>.06&&(h-=.02))):"hard"===challengeDifficulty&&(o+=5*r,f+=50*r*h,o>100&&(o=100),f>100&&(f=0,u+=1,h>.06&&(h-=.02))),e.set("levelResistance",h),e.set("progress",f.toString()),e.set("level",u.toString()),e.set("criticalthinkingSkill",o),k=(u+9)*((e.get("criticalthinkingSkill")+e.get("timetrialSkill")+e.get("recognitionSkill")+e.get("definitionsSkill")+e.get("aboveandbeyondSkill"))/500),e.set("trueRank",k),e.save()):"Recognition"===s?(o=e.get("recognitionSkill"),challengeDifficulty=e.get("currentChallengeDifficulty"),"easy"===challengeDifficulty?(o+=1*r,f+=5*r*h,o>100&&(o=100),f>100&&(f=0,u+=1,h>.06&&(h-=.02))):"medium"===challengeDifficulty?(o+=2.5*r,f+=10*r*h,o>100&&(o=100),f>100&&(f=0,u+=1,h>.06&&(h-=.02))):"hard"===challengeDifficulty&&(o+=5*r,f+=50*r*h,o>100&&(o=100),f>100&&(f=0,u+=1,h>.06&&(h-=.02))),e.set("levelResistance",h),e.set("progress",f.toString()),e.set("level",u.toString()),e.set("criticalthinkingSkill",o),k=(u+9)*((e.get("criticalthinkingSkill")+e.get("timetrialSkill")+e.get("recognitionSkill")+e.get("definitionsSkill")+e.get("aboveandbeyondSkill"))/500),e.set("trueRank",k),e.save()):"Definitions"===s?(o=e.get("definitionsSkill"),challengeDifficulty=e.get("currentChallengeDifficulty"),"easy"===challengeDifficulty?(o+=1*r,f+=5*r*h,o>100&&(o=100),f>100&&(f=0,u+=1,h>.06&&(h-=.02))):"medium"===challengeDifficulty?(o+=2.5*r,f+=10*r*h,o>100&&(o=100),f>100&&(f=0,u+=1,h>.06&&(h-=.02))):"hard"===challengeDifficulty&&(o+=5*r,f+=50*r*h,o>100&&(o=100),f>100&&(f=0,u+=1,h>.06&&(h-=.02))),e.set("levelResistance",h),e.set("progress",f.toString()),e.set("level",u.toString()),e.set("criticalthinkingSkill",o),k=(u+9)*((e.get("criticalthinkingSkill")+e.get("timetrialSkill")+e.get("recognitionSkill")+e.get("definitionsSkill")+e.get("aboveandbeyondSkill"))/500),e.set("trueRank",k),e.save()):"Above and Beyond"===s&&(o=e.get("aboveandbeyondSkill"),challengeDifficulty=e.get("currentChallengeDifficulty"),"easy"===challengeDifficulty?(o+=1*r,f+=5*r*h,o>100&&(o=100),f>100&&(f=0,u+=1,h>.06&&(h-=.02))):"medium"===challengeDifficulty?(o+=2.5*r,f+=10*r*h,o>100&&(o=100),f>100&&(f=0,u+=1,h>.06&&(h-=.02))):"hard"===challengeDifficulty&&(o+=5*r,f+=50*r*h,o>100&&(o=100),f>100&&(f=0,u+=1,h>.06&&(h-=.02))),e.set("levelResistance",h),e.set("progress",f.toString()),e.set("level",u.toString()),e.set("criticalthinkingSkill",o),k=(u+9)*((e.get("criticalthinkingSkill")+e.get("timetrialSkill")+e.get("recognitionSkill")+e.get("definitionsSkill")+e.get("aboveandbeyondSkill"))/500),e.set("trueRank",k),e.save());var d=Parse.Object.extend("User"),y=new Parse.Query(d);y.descending("trueRank"),y.find({success:function(i){for(var t=0;t<i.length;t++)i[t].get("username")===e.get("username")&&(c=!1,$("#rankField").text("Rank: "+a)),c&&a++},error:function(e){alert("Error: "+e.code+" "+e.message)}}),0===f?$("#levelField").text("Level: "+u+"(+)"):$("#levelField").text("Level: "+u),$("#skillCircle").circleProgress({value:o/100,size:80,fill:{gradient:["red","orange"]}}).on("circle-animation-progress",function(e,i){$(this).find("strong").html(parseInt(i/(1/(o/100))*100)+"<i>%</i>")}),$("#scoreCircle").circleProgress({value:r,size:80,fill:{gradient:["blue","green"]}}).on("circle-animation-progress",function(e,i){$(this).find("strong").html(parseInt(i/(1/r)*100)+"<i>%</i>")})},error:function(e,i){}});var i=e.get("progress");$("#progressbarField").attr("data-pro-bar-percent",i),$("#profilePicture").attr("src",e.get("profilePicture").url())});